# Echo 项目任务列表

本文件用于跟踪 Echo 项目的开发进度和任务管理。

## 任务表格

| ID | 任务名称 | 状态 | 子任务 | 依赖关系 | 预计完成时间 |
|---|---|---|---|---|---|
| T001 | 项目基础结构搭建 | ✅ 已完成 | T001-1, T001-3, T001-4, T001-5 | 无 | 已完成 |
| T001-1 | 创建前端项目结构 | ✅ 已完成 | 无 | 无 | 已完成 |
| T001-3 | 设置MCP客户端和服务端目录 | ✅ 已完成 | 无 | 无 | 已完成 |
| T001-4 | 配置Git版本控制 | ✅ 已完成 | 无 | 无 | 已完成 |
| T001-5 | 初始化后端(Python)项目结构 | ✅ 已完成 | T001-5-1, T001-5-2 | 无 | 已完成 |
| T001-5-1 | 清理旧后端代码 | ✅ 已完成 | 无 | 无 | 已完成 |
| T001-5-2 | 创建基础目录和配置文件 | ✅ 已完成 | 无 | 无 | 已完成 |
| T002 | 配置开发环境 | ✅ 已完成 | T002-1, T002-2, T002-3, T002-4 | T001 | 已完成 |
| T002-1 | 安装前端依赖包 | ✅ 已完成 | 无 | T001-1 | 已完成 |
| T002-2 | 配置前端环境变量 | ✅ 已完成 | 无 | T001-1 | 已完成 |
| T002-3 | 设置前端开发服务器 | ✅ 已完成 | 无 | T001-1, T002-1, T002-2 | 已完成 |
| T002-4 | 安装后端(Python)依赖 | ✅ 已完成 | 无 | T001-5 | 已完成 |
| T003 | 实现任务列表管理规则 | ✅ 已完成 | T003-1, T003-2, T003-3 | 无 | 已完成 |
| T003-1 | 定义任务列表格式 | ✅ 已完成 | 无 | 无 | 已完成 |
| T003-2 | 创建任务管理文档 | ✅ 已完成 | 无 | T003-1 | 已完成 |
| T003-3 | 实现任务状态跟踪机制 | ✅ 已完成 | 无 | T003-1, T003-2 | 已完成 |
| T004 | 完善前端界面设计 | 🔄 进行中 | T004-1, T004-2, T004-3, T013 | T001, T002 | 2024-Q3 |
| T004-1 | 设计并实现主页面布局 | 🔄 进行中 | T004-1-1, T004-1-2, T004-1-3 | T001-1 | 2024-Q3 |
| T004-1-1 | 创建响应式导航栏 | ✅ 已完成 | 无 | T004-1 | 已完成 |
| T004-1-2 | 设计主内容区域 | 🔄 进行中 | 无 | T004-1-1 | 2024-Q3 |
| T004-1-3 | 实现页脚组件 | ⏳ 待开始 | 无 | T004-1-1 | 2024-Q3 |
| T004-2 | 开发用户交互组件 | 🔥 MVP 重点 | T004-2-1, T004-2-2, T004-2-3 | T004-1 | 2024-Q3 |
| T004-2-1 | 实现语音输入按钮 | 🔄 进行中 | 无 | T004-1 | 2024-Q3 |
| T004-2-2 | 创建消息显示区域 | 🔄 进行中 | 无 | T004-1 | 2024-Q3 |
| T004-2-3 | 添加加载状态指示器 | ⏳ 待开始 | 无 | T004-1 | 2024-Q3 |
| T004-3 | 优化UI/UX体验 | ⏳ 待开始 | T004-3-1, T004-3-2, T004-3-3 | T004-1, T004-2 | 2024-Q3 |
| T004-3-1 | 实现深色/浅色主题切换 | ⏳ 待开始 | 无 | T004-1, T004-2 | 2024-Q3 |
| T004-3-2 | 添加动画效果 | ⏳ 待开始 | 无 | T004-1, T004-2 | 2024-Q3 |
| T004-3-3 | 确保无障碍访问 | ⏳ 待开始 | 无 | T004-1, T004-2 | 2024-Q3 |
| T013 | 实现前端基础路由 | ✅ 已完成 | T013-1, T013-2, T013-3 | T001-1 | 已完成 |
| T013-1 | 创建基础页面组件 (占位) | ✅ 已完成 | 无 | T001-1 | 已完成 |
| T013-2 | 配置 App.js 路由规则 | ✅ 已完成 | 无 | T013-1 | 已完成 |
| T013-3 | 修改导航栏实现页面跳转 | ✅ 已完成 | 无 | T013-2 | 已完成 |
| T020 | 后端 MVP (Python) 实现 | 🔄 进行中 | T020-1, T020-2, T020-3, T020-4, T020-5, T020-6, T020-7, T020-8 | T001-5, T002-4 | 2024-Q3 |
| T020-1 | 配置后端环境与依赖 | ✅ 已完成 | T020-1-1, T020-1-2 | T001-5 | 已完成 |
| T020-1-1 | 定义 requirements.txt | ✅ 已完成 | 无 | T001-5 | 已完成 |
| T020-1-2 | 实现 app/config.py 配置加载 | ✅ 已完成 | 无 | T020-1-1 | 已完成 |
| T020-2 | 实现 FastAPI 应用基础 | ✅ 已完成 | T020-2-1, T020-2-2 | T020-1 | 已完成 |
| T020-2-1 | 创建 app/main.py 入口 | ✅ 已完成 | 无 | T020-1 | 已完成 |
| T020-2-2 | 添加 CORS 和健康检查 | ✅ 已完成 | 无 | T020-2-1 | 已完成 |
| T020-3 | 实现数据库模型与迁移 | ✅ 已完成 | T020-3-1, T020-3-2, T020-3-3 | T020-1 | 已完成 |
| T020-3-1 | 定义 SQLAlchemy 模型 (User, Tool, Session, Log) | ✅ 已完成 | 无 | T020-1 | 已完成 |
| T020-3-2 | 配置 Alembic | ✅ 已完成 | 无 | T020-3-1 | 已完成 |
| T020-3-3 | 生成并执行初始数据库迁移 | ✅ 已完成 | 无 | T020-3-2 | 已完成 |
| T020-4 | 实现 OpenAI Client | ✅ 已完成 | 无 | T020-1 | 已完成 |
| T020-5 | 实现 MCP Client | ✅ 已完成 | 无 | T020-1 | 已完成 |
| T020-6 | 实现 /intent/process API | ✅ 已完成 | T020-6-1, T020-6-2, T020-6-3, T020-6-4 | T020-2, T020-3, T020-4 | 已完成 |
| T020-6-1 | 创建 Intent Schema | ✅ 已完成 | 无 | T020-2 | 已完成 |
| T020-6-2 | 创建 Intent Router | ✅ 已完成 | 无 | T020-2 | 已完成 |
| T020-6-3 | 创建 Intent Controller | ✅ 已完成 | 无 | T020-2 | 已完成 |
| T020-6-4 | 创建 Intent Service (重构为标准工具调用) | ✅ 已完成 | 无 | T020-3, T020-4 | 已完成 |
| T020-7 | 实现 /execute API (重构) | 🔥 MVP 重点 | T020-7-1, T020-7-2, T020-7-3, T020-7-4, T020-7-5, T020-7-6, T020-7-7, T020-7-8, T020-7-9 | T020-2, T020-3, T020-5 | 2024-Q3 |
| T020-7-1 | 创建 Execute Schema | ✅ 已完成 | 无 | T020-2 | 已完成 |
| T020-7-2 | 创建 Execute Router | ✅ 已完成 | 无 | T020-2 | 已完成 |
| T020-7-3 | 创建 Execute Controller | ✅ 已完成 | 无 | T020-2 | 已完成 |
| T020-7-4 | 创建 Execute Service (需重构) | 🔥 MVP 重点 | 无 | T020-3, T020-5 | 2024-Q3 |
| T020-7-5 | 修改 Tool 模型添加 server_name 字段 | ⏳ 待开始 | 无 | T020-3-1 | 2024-Q3 |
| T020-7-6 | 创建 Alembic 迁移脚本添加 server_name 列 | ⏳ 待开始 | 无 | T020-7-5 | 2024-Q3 |
| T020-7-7 | 更新 execute_service 查询 Tool 并获取 server_name | ⏳ 待开始 | 无 | T020-7-4, T020-7-5 | 2024-Q3 |
| T020-7-8 | 修改 execute_service 调用 mcp_client 时传递 target_server | ⏳ 待开始 | 无 | T020-7-7 | 2024-Q3 |
| T020-7-9 | 实现 execute_service 对 HTTP 类型工具的调用 | 🔥 MVP 重点 | 无 | T020-7-4 | 2024-Q3 |
| T020-8 | 添加基础单元/集成测试 | ⏳ 待开始 | 无 | T020-6, T020-7 | 2024-Q3 |
| T021 | 修复后端关键问题 | ✅ 已完成 | T021-1, T021-2 | T020 | 已完成 |
| T021-1 | 修复数据库连接问题 | ✅ 已完成 | 无 | T020-2 | 已完成 |
| T021-2 | 优化MCP客户端集成 (支持动态连接) | ✅ 已完成 | 无 | T020-5 | 已完成 |
| T022 | 修复后端启动和配置问题 | ✅ 已完成 | T022-1, T022-2, T022-3 | T020 | 已完成 |
| T022-1 | 修复配置类验证错误 | ✅ 已完成 | 无 | T020-1 | 已完成 |
| T022-2 | 修复数据库连接参数错误 | ✅ 已完成 | 无 | T020-1 | 已完成 |
| T022-3 | 修复主应用配置引用错误 | ✅ 已完成 | 无 | T020-2 | 已完成 |
| T023 | 重命名配置变量为 LLM_* | ✅ 已完成 | T023-1, T023-2, T023-3 | T020-1, T020-4, T020-5 | 已完成 |
| T023-1 | 更新 config.py | ✅ 已完成 | 无 | T020-1 | 已完成 |
| T023-2 | 更新 openai_client.py | ✅ 已完成 | 无 | T020-4 | 已完成 |
| T023-3 | 更新 mcp_client.py (包装器) | ✅ 已完成 | 无 | T020-5 | 已完成 |
| T024 | 实现用户身份认证系统 | 🔄 进行中 | T024-1, T024-2, T024-3, T024-4, T024-5 | T020-2, T020-3 | 2024-Q4 |
| T024-1 | 创建用户注册和登录API | ✅ 已完成 | 无 | T020-3-1 | 已完成 |
| T024-2 | 实现JWT认证中间件 | ✅ 已完成 | 无 | T024-1 | 已完成 |
| T024-3 | 创建用户管理页面 | ⏳ 待开始 | 无 | T024-1 | 2024-Q4 |
| T024-4 | 集成环境分离的认证逻辑 | ⏳ 待开始 | 无 | T024-2 | 2024-Q4 |
| T024-5 | 编写认证系统测试脚本 | ✅ 已完成 | 无 | T024-1, T024-2 | 已完成 |

## 实施计划

本项目将按照模块化开发方式进行，前后端分离，使用RESTful API进行通信。每个子任务完成后将进行单元测试和集成测试，确保功能正常运行。

### 相关文件

- `frontend/src/App.js` - 前端应用入口
- `backend/app/main.py` - 后端服务入口 (Python/FastAPI)
- `backend/app/services/intent_service.py` - 意图解析服务
- `backend/app/services/execute_service.py` - 工具执行服务 ✅
- `backend/app/routers/intent.py` - 意图解析 API 路由
- `backend/app/routers/execute.py` - 工具执行 API 路由 ✅
- `backend/app/schemas/intent.py` - 意图 API 数据模型
- `backend/app/schemas/execute.py` - 执行 API 数据模型 ✅
- `backend/app/controllers/intent_controller.py` - 意图处理控制器
- `backend/app/controllers/execute_controller.py` - 工具执行控制器 ✅
- `backend/app/utils/mcp_client.py` - MCP客户端包装器
- `backend/app/utils/openai_client.py` - LLM客户端包装器 (兼容 OpenAI SDK)
- `backend/app/utils/db.py` - 数据库工具类
- `MCP_Client/mcp_client.py` - MCP客户端实现
- `MCP_server/web3-mcp/` - Web3 MCP服务实现

### 技术架构

- 前端：React.js
- 后端：Python + FastAPI + Uvicorn
- 数据库：MySQL + SQLAlchemy + Alembic
- NLU引擎：LLM (兼容 OpenAI SDK)
- STT/TTS：浏览器 Web Speech API
- 会话管理：JWT + Redis (可选)
- 部署运维：Docker Compose → Kubernetes（后续）
- MCP客户端：Python
- MCP服务端：TypeScript

### 数据流

```
前端 --> 语音输入 --> STT --> 后端接收文本
后端 --> LLM解析 --> 生成{intent, params, confirmText}
后端 --> 返回confirmText等 --> 前端TTS播报
前端 --> STT监听用户确认 --> 前端解析意图 (CONFIRM/RETRY/CANCEL)
前端 --> 确认后请求执行 --> 后端 /execute (tool_id, params)
后端 --> MCP网关/HTTP --> 获取执行结果
后端 --> 返回结果 --> 前端TTS播报
```

### 测试策略

- 单元测试：针对每个组件和函数的独立测试
- 集成测试：测试模块间的交互
- 端到端测试：模拟用户行为的完整流程测试
- 性能测试：确保系统在高负载下的稳定性

### 最近更新

- 2025-05-14: 实现了用户身份认证系统，包括用户注册和登录API，JWT认证中间件，以及对应的测试脚本
- 2025-05-14: 创建了用户身份认证系统的任务清单，计划实现JWT认证、用户注册和登录功能
- 2025-05-14: 完成修复`/api/v1/interpret`和`/api/v1/execute` API中session_id在响应中为null的问题
- 2025-05-13: 修复了 `/api/v1/interpret` API 中 `session_id` 在响应中为 null 的问题，并确保 `userId` 字段强制必填
- 2025-04-28: 完成了 `/execute` API 的实现 (Schema, Service, Controller, Router)
- 2025-04-28: 重命名配置变量为 LLM_*，以支持通用 LLM
- 2025-04-28: 修复了多个后端启动和配置问题
- 2025-04-28: 修复了数据库连接问题和MCP客户端集成问题
- 2025-04-28: 完成了Intent API的实现，可通过/api/v1/intent/process接口处理用户意图
- 2025-04-28: 完成了后端配置加载和环境变量管理

---

## 当前开发状态总结 (基于 2025-05-13 测试)

后端已完成 MVP 的核心功能闭环 (意图识别 -> 工具决策 -> 工具执行 -> 结果返回)，并集成了 LLM、MCP 客户端和 HTTP 工具调用。

## 需要优化/验证/补充

-   [ ] **后端**: 优化 LLM Prompt 和工具 Schema 以提高实体识别准确率 (例如识别 "明天") - *Prompt 已初步优化，关键在于数据库 Schema 更新*
-   [x] **后端**: **修复 Session ID 在 API 响应中为 null 的问题** *(已完成：2025-05-14)*
-   [x] **后端**: 实现 JWT 用户身份认证和 API 保护 (根据文档) *(已完成：2025-05-14)*
-   [ ] **后端**: 实现并测试 `/api/v1/tools` 接口 (如果需要)
-   [ ] **后端**: 安装并配置代码格式化/检查工具 (`black`, `ruff`) - *已安装，需后续持续使用*
-   [ ] **文档**: 更新 PRD 和后端开发文档，使其与最新的 API 实现保持一致 (路径、字段名、响应结构等)
-   [ ] **前端**: 完成所有 MVP 所需的前端功能和交互流程
-   [ ] **联调**: 进行完整的前后端联调测试，验证包括复述确认在内的完整交互流程

## 未来迭代 (参考 `待开发功能点集合.md`)

-   [ ] **后端**: 实现 MCP 服务智能路由 (T001)
-   [ ] **后端**: 增强 API 安全性 (HTTPS, 认证 - T003)
-   [ ] **后端**: 实现 API 速率限制 (T004)
-   [ ] **后端**: 强化工具接入流程安全性 (T005)
-   [ ] **后端**: 实现 MCP 工具信息自动同步 (T006)
-   [ ] **后端**: LLM Prompt 数据库化管理 (T007)
-   [ ] **后端**: 灵活的应用配置管理机制 (T008)
-   [ ] **后端**: 多语言支持 (T009)
-   [ ] **后端**: 前端展示结构化工具结果 (T010)
-   [ ] ... (其他待评估的功能点)