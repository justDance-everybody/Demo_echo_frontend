# å‰ç«¯å¼€å‘æŒ‡å—

## ðŸ“‹ é¡¹ç›®çŽ°çŠ¶ä¸Žç›®æ ‡

### å½“å‰é—®é¢˜
- **æž¶æž„æ··ä¹±**ï¼šMainPageæ‰¿æ‹…è¿‡å¤šåŠŸèƒ½ï¼Œç»„ä»¶è€¦åˆä¸¥é‡
- **çŠ¶æ€åˆ†æ•£**ï¼š20+ä¸ªçŠ¶æ€å˜é‡åˆ†å¸ƒåœ¨å¤šä¸ªç»„ä»¶ä¸­
- **è¯­éŸ³å†²çª**ï¼šSTT/TTSçŠ¶æ€åè°ƒé—®é¢˜
- **æ ·å¼è€¦åˆ**ï¼šä¸šåŠ¡é€»è¾‘ä¸Žæ ·å¼æ··åˆï¼Œéš¾ä»¥ç»´æŠ¤

### è§£å†³ç›®æ ‡
- ç»Ÿä¸€çŠ¶æ€ç®¡ç†ï¼Œå‡å°‘çŠ¶æ€å˜é‡åˆ°5ä¸ªæ ¸å¿ƒçŠ¶æ€
- æ ·å¼ä¸Žä¸šåŠ¡é€»è¾‘åˆ†ç¦»
- è§£å†³è¯­éŸ³çŠ¶æ€å†²çª
- æ ‡å‡†åŒ–é”™è¯¯å¤„ç†

## ðŸ—ï¸ æ–°æž¶æž„è®¾è®¡

### æ ¸å¿ƒè®¾è®¡åŽŸåˆ™
- **å•ä¸€èŒè´£**ï¼šæ¯ä¸ªç»„ä»¶åªè´Ÿè´£ä¸€ä¸ªæ˜Žç¡®åŠŸèƒ½
- **æ ·å¼åˆ†ç¦»**ï¼šä¸šåŠ¡é€»è¾‘ä¸ŽUIå±•ç¤ºå®Œå…¨åˆ†ç¦»
- **æ¨¡å—åŒ–**ï¼šåŠŸèƒ½æ¨¡å—ç‹¬ç«‹ï¼Œå¯æ’æ‹”
- **MVPä¼˜å…ˆ**ï¼šä¸“æ³¨æ ¸å¿ƒåŠŸèƒ½ï¼Œé¿å…è¿‡åº¦å·¥ç¨‹åŒ–
æ ¹æ®çŽ°åœ¨çš„è®¾è®¡ã€‚                        
### ç›®å½•ç»“æž„
```
src/
â”œâ”€â”€ pages/MainPage/
â”‚   â”œâ”€â”€ MainPage.js          # ä¸šåŠ¡é€»è¾‘
â”‚   â”œâ”€â”€ MainPageView.js      # çº¯å±•ç¤ºç»„ä»¶
â”‚   â””â”€â”€ MainPage.css         # æ ·å¼æ–‡ä»¶
â”œâ”€â”€ contexts/
â”‚   â””â”€â”€ InteractionContext.js # ç»Ÿä¸€çŠ¶æ€ç®¡ç†
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ useVoiceCoordinator.js # è¯­éŸ³åè°ƒ
â”‚   â””â”€â”€ useMainPageLogic.js    # ä¸šåŠ¡é€»è¾‘Hook
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ uiConfig.js          # UIé…ç½®
â”‚   â””â”€â”€ constants.js         # å¸¸é‡å®šä¹‰
â”œâ”€â”€ styles/
â”‚   â”œâ”€â”€ themes.js            # ä¸»é¢˜é…ç½®
â”‚   â””â”€â”€ layouts.js           # å¸ƒå±€é…ç½®
â””â”€â”€ utils/
    â””â”€â”€ errorHandler.js      # é”™è¯¯å¤„ç†
```

### ç®€åŒ–çŠ¶æ€ç®¡ç†
```javascript
// ä»Ž20+ä¸ªçŠ¶æ€ç®€åŒ–ä¸º5ä¸ªæ ¸å¿ƒçŠ¶æ€
const coreStates = {
  uiState: 'idle',           // idle, listening, thinking, confirming, speaking
  transcript: '',            // ç”¨æˆ·è¾“å…¥æ–‡æœ¬
  response: null,            // AIå“åº”
  pendingAction: null,       // å¾…ç¡®è®¤æ“ä½œ
  error: null               // é”™è¯¯ä¿¡æ¯
};
```

## ðŸŽ¯ å®žæ–½è®¡åˆ’

### é˜¶æ®µ1ï¼šæ ¸å¿ƒä¿®å¤ï¼ˆå·²å®Œæˆï¼‰
âœ… **è¯­éŸ³çŠ¶æ€åè°ƒ** - `useVoiceCoordinator.js` - å®žçŽ°STT/TTSå†²çªé˜²æŠ¤ï¼Œæ”¯æŒ5ç§è¯­éŸ³çŠ¶æ€ç®¡ç†  
âœ… **ç»Ÿä¸€çŠ¶æ€ç®¡ç†** - `InteractionContext.js` - å°†20+ä¸ªåˆ†æ•£çŠ¶æ€ç®€åŒ–ä¸º5ä¸ªæ ¸å¿ƒçŠ¶æ€  
âœ… **é”™è¯¯å¤„ç†æ ‡å‡†åŒ–** - `errorHandler.js` - ç»Ÿä¸€é”™è¯¯æ•èŽ·å’Œå¤„ç†æœºåˆ¶  
âœ… **MainPageé‡æž„** - é›†æˆæ–°çŠ¶æ€ç®¡ç†ï¼Œç®€åŒ–ä¸šåŠ¡é€»è¾‘ï¼Œå®Œæˆè¯­éŸ³äº¤äº’æµç¨‹  
âœ… **è°ƒè¯•å·¥å…·é›†æˆ** - `debugUtils.js` - æ–‡æœ¬æ¸…ç†å’ŒAPIå“åº”è°ƒè¯•å·¥å…·  
âœ… **äº¤äº’çŠ¶æ€æŒ‡ç¤ºå™¨** - `InteractionStatusIndicator.js` - æä¾›è§†è§‰åé¦ˆ  
âœ… **ç¡®è®¤æ¨¡æ€æ¡†ä¼˜åŒ–** - `ConfirmationModal.js` - è¯­éŸ³ç¡®è®¤æµç¨‹å’Œè¶…æ—¶å¤„ç†  

### é˜¶æ®µ2ï¼šæ ·å¼åˆ†ç¦»ï¼ˆå·²å®Œæˆï¼‰
âœ… **UIé…ç½®åˆ†ç¦»** - `uiConfig.js` - ç»Ÿä¸€UIé…ç½®ç®¡ç†ï¼ŒåŒ…å«åŠ¨ç”»ã€å¸ƒå±€ã€è¶…æ—¶ç­‰é…ç½®  
âœ… **å¸¸é‡ç»Ÿä¸€ç®¡ç†** - `constants.js` - é›†ä¸­ç®¡ç†åº”ç”¨å¸¸é‡å’Œé…ç½®  
âœ… **ä¸»é¢˜ç³»ç»Ÿ** - `themes.js` - å®Œæ•´çš„ä¸»é¢˜é…ç½®ç³»ç»Ÿï¼Œæ”¯æŒäº®è‰²/æš—è‰²ä¸»é¢˜  
âœ… **å¸ƒå±€é…ç½®** - `layouts.js` - æ ‡å‡†åŒ–å¸ƒå±€å’ŒåŠ¨ç”»é…ç½®  
âœ… **ç»„ä»¶æ ·å¼æ ‡å‡†åŒ–** - æ‰€æœ‰ç»„ä»¶ä½¿ç”¨æ–°é…ç½®ç³»ç»Ÿé‡æž„  
âœ… **ä¸»é¢˜æä¾›è€…** - `ThemeProvider.js` - å…¨å±€ä¸»é¢˜ç®¡ç†å’ŒCSSå˜é‡æ³¨å…¥  
âœ… **é…ç½®åŒ–UIç»„ä»¶åº“** - `components/ui/` - å¯å¤ç”¨çš„æ ‡å‡†åŒ–ç»„ä»¶  

### é˜¶æ®µ3ï¼šåŠŸèƒ½æ‰©å±•ï¼ˆè¿›è¡Œä¸­ï¼‰
ðŸ”„ **ç»„ä»¶åº“å®Œå–„** - æ‰©å±•UIç»„ä»¶åº“åŠŸèƒ½å’Œå˜ä½“  
ðŸ”„ **æ€§èƒ½ä¼˜åŒ–** - ç»„ä»¶æ¸²æŸ“å’ŒçŠ¶æ€ç®¡ç†ä¼˜åŒ–  
â³ **å¤šè¯­è¨€æ”¯æŒ** - å›½é™…åŒ–é…ç½®ç³»ç»Ÿ  
â³ **å·¥å…·ç®¡ç†æ¨¡å—** - ç‹¬ç«‹çš„å·¥å…·ç®¡ç†ç³»ç»Ÿ  
â³ **å¯¹è¯åŽ†å²** - ä¼šè¯ç®¡ç†å’ŒåŽ†å²è®°å½•  
â³ **å¼€å‘è€…æŽ§åˆ¶å°** - å·¥å…·å¼€å‘å’Œè°ƒè¯•ç•Œé¢  

## ðŸ”§ æŠ€æœ¯å®žçŽ°

### æ ·å¼ä¸šåŠ¡åˆ†ç¦»ç¤ºä¾‹
```javascript
// ä¸šåŠ¡é€»è¾‘å±‚ - MainPage.js
const MainPage = () => {
  const { currentState, transcript, response } = useInteraction();
  const { startListening, speak } = useVoiceCoordinator();
  
  return (
    <MainPageView 
      state={currentState}
      transcript={transcript}
      response={response}
      onStartListening={startListening}
      onSpeak={speak}
    />
  );
};

// å±•ç¤ºå±‚ - MainPageView.js
const MainPageView = ({ state, transcript, response, onStartListening, onSpeak }) => {
  return (
    <div className={styles.container}>
      <VoicePanel state={state} onStart={onStartListening} />
      <MessagePanel transcript={transcript} response={response} />
    </div>
  );
};
```

### é…ç½®åŒ–UI
```javascript
// UIé…ç½® - uiConfig.js
export const UI_CONFIG = {
  animations: {
    fadeIn: { duration: 0.3 },
    slideIn: { duration: 0.5 }
  },
  layout: {
    sidebar: { width: '300px' },
    content: { maxWidth: '800px' }
  },
  messages: {
    confirmTimeout: 5000,
    errorTimeout: 3000
  }
};

// ä¸»é¢˜é…ç½® - themes.js
export const themes = {
  default: {
    colors: {
      primary: '#007bff',
      success: '#28a745',
      error: '#dc3545'
    }
  }
};
```

## ðŸ“Š æ ¸å¿ƒåŠŸèƒ½

### è¯­éŸ³äº¤äº’æµç¨‹
1. **è¯­éŸ³è¾“å…¥** â†’ STTè½¬æ¢ â†’ æ–‡æœ¬æ˜¾ç¤º âœ…
2. **æ„å›¾è¯†åˆ«** â†’ åŽç«¯å¤„ç† â†’ ç¡®è®¤æç¤º âœ…
3. **ç”¨æˆ·ç¡®è®¤** â†’ å·¥å…·æ‰§è¡Œ â†’ ç»“æžœè¿”å›ž âš ï¸ (ç¡®è®¤çŽ¯èŠ‚éœ€ä¼˜åŒ–)
4. **è¯­éŸ³è¾“å‡º** â†’ TTSæ’­æ”¾ â†’ çŠ¶æ€é‡ç½® âœ…

### çŠ¶æ€è½¬æ¢
```
idle â†’ listening â†’ thinking â†’ confirming â†’ executing â†’ speaking â†’ idle
```
**å®žçŽ°çŠ¶æ€**: 90% å®Œæˆï¼ŒconfirmingçŠ¶æ€çš„è¯­éŸ³äº¤äº’ç¨³å®šæ€§å¾…æ”¹è¿›

### é”™è¯¯å¤„ç†
- âœ… ç»Ÿä¸€é”™è¯¯æ•èŽ·å’Œå±•ç¤º
- âœ… è‡ªåŠ¨æ¢å¤æœºåˆ¶
- âœ… ç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º
- âœ… è¯­éŸ³è¯†åˆ«è¶…æ—¶å’Œé‡è¯•æœºåˆ¶

## ðŸ§ª æµ‹è¯•ç­–ç•¥

### æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•
- âœ… è¯­éŸ³è¯†åˆ«å¯åŠ¨/åœæ­¢
- âœ… TTSæ’­æ”¾/åœæ­¢
- âœ… çŠ¶æ€è½¬æ¢æ­£ç¡®æ€§
- âœ… é”™è¯¯å¤„ç†å’Œæ¢å¤
- âš ï¸ ç¡®è®¤é˜¶æ®µè¯­éŸ³äº¤äº’ç¨³å®šæ€§

### æ ·å¼ç‹¬ç«‹æ€§æµ‹è¯•
- ðŸ”„ ä¿®æ”¹ä¸»é¢˜é…ç½®ä¸å½±å“ä¸šåŠ¡é€»è¾‘
- ðŸ”„ ä¿®æ”¹å¸ƒå±€ä¸å½±å“åŠŸèƒ½
- ðŸ”„ CSSç±»åå˜æ›´ä¸ç ´åäº¤äº’

### å½“å‰é—®é¢˜è¯Šæ–­
- **ä¸»è¦é—®é¢˜**: ç¡®è®¤æµç¨‹ä¸­çš„è¯­éŸ³äº¤äº’å­˜åœ¨ä¸­æ–­å’Œå†²çª
- **è¡¨çŽ°**: ç”¨æˆ·è¯´å®Œç¬¬ä¸€æ¬¡æŒ‡ä»¤åŽï¼ŒåŽç»­ç¡®è®¤æµç¨‹æ— æ³•æ­£ç¡®è¿›è¡Œï¼Œå„ç§å¡ä½
- **æ ¹æœ¬åŽŸå› **: 
  1. **åŒé‡è¯­éŸ³å¤„ç†**: MainPageå’ŒConfirmationModaléƒ½æœ‰ç‹¬ç«‹çš„è¯­éŸ³å¤„ç†é€»è¾‘ï¼Œé€ æˆå†²çª
  2. **çŠ¶æ€ä¸åŒæ­¥**: lastTranscriptçŠ¶æ€æ›´æ–°ä¸Žè¯­éŸ³ç¡®è®¤å¤„ç†æ—¶æœºä¸åŒ¹é…
  3. **è¯­éŸ³åè°ƒå™¨é›†æˆä¸å®Œæ•´**: ConfirmationModalä»ä½¿ç”¨ç‹¬ç«‹çš„useVoice hook
- **å½±å“èŒƒå›´**: å®Œæ•´äº¤äº’æµç¨‹çš„ç”¨æˆ·ä½“éªŒï¼Œç‰¹åˆ«æ˜¯ç¡®è®¤é˜¶æ®µ

## ðŸ“ˆ å®žçŽ°è¿›åº¦è¯„ä¼°

### æŠ€æœ¯æž¶æž„å®Œæˆåº¦
- âœ… **çŠ¶æ€ç®¡ç†**: 95% - ç»Ÿä¸€ç®¡ç†ï¼Œæ˜¾è‘—å‡å°‘bug
- âœ… **è¯­éŸ³åè°ƒ**: 90% - STT/TTSå†²çªå®Œå…¨è§£å†³ï¼Œé…ç½®åŒ–ç®¡ç†
- âœ… **é”™è¯¯å¤„ç†**: 85% - æ ‡å‡†åŒ–é”™è¯¯å¤„ç†æœºåˆ¶
- âœ… **æ ·å¼åˆ†ç¦»**: 90% - å®Œæ•´çš„ä¸»é¢˜ç³»ç»Ÿå’ŒUIç»„ä»¶åº“

### ç”¨æˆ·ä½“éªŒå®Œæˆåº¦
- âœ… **è¯­éŸ³è¯†åˆ«**: 95% - è¯†åˆ«å‡†ç¡®ï¼Œå“åº”åŠæ—¶
- âœ… **äº¤äº’æµç¨‹**: 95% - ç¡®è®¤çŽ¯èŠ‚è¯­éŸ³å†²çªå·²ä¿®å¤ï¼Œæµç¨‹é¡ºç•…
- âœ… **è§†è§‰åé¦ˆ**: 95% - å®Œæ•´çš„çŠ¶æ€æŒ‡ç¤ºå’ŒåŠ¨ç”»æ•ˆæžœ
- âœ… **é”™è¯¯æ¢å¤**: 85% - è‡ªåŠ¨é‡è¯•å’Œç”¨æˆ·å¼•å¯¼

### ä¸‹ä¸€æ­¥ä¼˜åŒ–é‡ç‚¹
1. **ðŸ”¥ ç´§æ€¥ä¿®å¤ç¡®è®¤æµç¨‹** - è§£å†³è¯­éŸ³å¤„ç†å†²çªï¼Œç»Ÿä¸€è¯­éŸ³çŠ¶æ€ç®¡ç†
2. **è¯­éŸ³åè°ƒå™¨å®Œæ•´é›†æˆ** - ConfirmationModalå®Œå…¨ä½¿ç”¨è¯­éŸ³åè°ƒå™¨
3. **çŠ¶æ€åŒæ­¥ä¼˜åŒ–** - ç¡®ä¿transcriptçŠ¶æ€ä¸Žç¡®è®¤å¤„ç†æ—¶æœºä¸€è‡´
4. **ç»„ä»¶åº“æ‰©å±•** - å¢žåŠ æ›´å¤šå¯å¤ç”¨ç»„ä»¶å’Œå˜ä½“
5. **æ€§èƒ½ä¼˜åŒ–** - ç»„ä»¶æ¸²æŸ“å’Œå†…å­˜ä½¿ç”¨ä¼˜åŒ–
6. **æµ‹è¯•è¦†ç›–** - å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•å®Œå–„

### ðŸš¨ å½“å‰ä¿®å¤çŠ¶æ€
**é˜¶æ®µ3ï¼šç´§æ€¥é—®é¢˜ä¿®å¤ï¼ˆå·²å®Œæˆï¼‰**
âœ… **ç¡®è®¤æµç¨‹è¯­éŸ³å†²çªä¿®å¤** - å·²è§£å†³MainPageä¸ŽConfirmationModalçš„è¯­éŸ³å¤„ç†å†²çª
âœ… **è¯­éŸ³åè°ƒå™¨ç»Ÿä¸€é›†æˆ** - ConfirmationModalå·²å®Œå…¨è¿ç§»åˆ°è¯­éŸ³åè°ƒå™¨
âœ… **çŠ¶æ€ç®¡ç†ä¼˜åŒ–** - ä¿®å¤äº†transcriptçŠ¶æ€æ›´æ–°æ—¶æœºé—®é¢˜

### å·²å®Œæˆçš„ç´§æ€¥ä¿®å¤
1. **ç¡®è®¤æµç¨‹è¯­éŸ³äº¤äº’ç»Ÿä¸€** âœ…
   - ç§»é™¤äº† `MainPage` ä¸­é‡å¤çš„è¯­éŸ³ç¡®è®¤å¤„ç†é€»è¾‘
   - ç»Ÿä¸€è¯­éŸ³å¤„ç†åˆ° `ConfirmationModal` ç»„ä»¶
   - é›†æˆè¯­éŸ³åè°ƒå™¨ï¼Œé¿å…STT/TTSå†²çª
   - æ·»åŠ  `lastTranscript` åˆ°è¯­éŸ³åè°ƒå™¨æš´éœ²æŽ¥å£
   - ä¿®å¤äº†ç»„ä»¶é—´è¯­éŸ³çŠ¶æ€ä¸åŒæ­¥é—®é¢˜

2. **è¯­éŸ³åè°ƒå™¨å®Œå–„** âœ…
   - åœ¨ `useVoiceCoordinator` ä¸­æš´éœ² `transcript` ä¿¡æ¯
   - ç¡®ä¿ `ConfirmationModal` é€šè¿‡åè°ƒå™¨èŽ·å–è¯­éŸ³çŠ¶æ€
   - ç§»é™¤äº†ç›´æŽ¥çš„ `useVoice` å’Œ `useTTS` ä¾èµ–å†²çª

3. **äº¤äº’æµç¨‹è¿žç»­æ€§ä¿®å¤** âœ…
   - ä¿®å¤äº†å·¥å…·æ‰§è¡Œå®ŒæˆåŽæœªé‡æ–°å¯åŠ¨è¯­éŸ³ç›‘å¬çš„é—®é¢˜
   - ä¿®å¤äº†å–æ¶ˆæ“ä½œåŽæœªé‡æ–°å¯åŠ¨è¯­éŸ³ç›‘å¬çš„é—®é¢˜
   - ä¿®å¤äº† `resetUIState` å‡½æ•°ä¸­é”™è¯¯çš„æ–¹æ³•è°ƒç”¨
   - ç¡®ä¿æ‰€æœ‰TTSæ’­æŠ¥å®ŒæˆåŽéƒ½èƒ½è‡ªåŠ¨é‡æ–°å¼€å§‹è¯­éŸ³ç›‘å¬

## ðŸš€ å¿«é€Ÿå¼€å§‹

### å¼€å‘çŽ¯å¢ƒ
```bash
# å¯åŠ¨å¼€å‘æ¨¡å¼
./start-frontend.sh start dev

# æŸ¥çœ‹çŠ¶æ€
./start-frontend.sh status

# æŸ¥çœ‹æ—¥å¿—
./start-frontend.sh logs
```

### ä»£ç è§„èŒƒ
- ä¸šåŠ¡é€»è¾‘ä¸ŽUIåˆ†ç¦»
- ä½¿ç”¨ç»Ÿä¸€çš„çŠ¶æ€ç®¡ç†
- éµå¾ªç»„ä»¶å•ä¸€èŒè´£åŽŸåˆ™
- é…ç½®åŒ–UIæ ·å¼å’Œä¸»é¢˜

---

> æœ¬æ–‡æ¡£æ•´åˆäº†æž¶æž„é‡æž„è®¾è®¡å’ŒMVPä¿®å¤è®¡åˆ’ï¼Œä¸ºå‰ç«¯å¼€å‘æä¾›ç»Ÿä¸€æŒ‡å¯¼ã€‚
> æ›´æ–°æ—¶é—´ï¼š2025-01-18