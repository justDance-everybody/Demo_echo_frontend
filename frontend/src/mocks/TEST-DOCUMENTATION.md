# 前端自动化测试框架说明文档

## 概述

本文档介绍语音AI代理前端自动化测试框架的使用方法。该框架用于在不依赖真实麦克风和扬声器的情况下，自动化测试前端的语音交互和功能流程。

## 测试文件结构

测试框架位于 `/frontend/src/mocks` 目录下，包含以下文件：

1. `AutomatedTest.js` - 核心测试逻辑类，提供模拟语音输入和API调用的功能
2. `TestRunner.js` - 测试运行器UI组件，提供交互式测试界面
3. `TestPage.js` - 测试页面组件，集成测试运行器
4. `api-mock-extension.js` - API模拟扩展模块，为测试提供特定的API响应
5. `TEST-DOCUMENTATION.md` - 本文档

## 测试范围

当前版本的测试框架覆盖以下场景：

1. **基础语音识别测试**
   - 模拟用户语音输入
   - 验证语义理解API调用
   - 验证用户确认流程
   - 验证执行API调用

2. **语音确认测试**
   - 模拟用户语音输入特定指令
   - 验证确认流程的正确处理

3. **语音取消测试**
   - 测试用户取消操作的处理流程

4. **API错误处理测试**
   - 测试系统对API错误的处理能力

## 使用方法

### 1. 启动测试页面

访问测试页面路径：`http://localhost:3000/test`

### 2. 运行测试

在测试页面上：

1. 使用下拉菜单选择需要执行的测试场景（全部或单个场景）
2. 点击"开始测试"按钮
3. 观察控制台输出区域的测试执行过程
4. 测试完成后查看测试报告

### 3. 导出测试结果

点击"导出结果"按钮，下载JSON格式的测试结果文件，用于进一步分析或持久化保存。

## 开发和扩展

### 添加新的测试场景

在 `AutomatedTest.js` 文件中，向 `testScenarios` 数组添加新的测试场景：

```javascript
{
  name: '新测试场景名称',
  steps: [
    { action: 'speak', text: '用户语音文本' },
    { action: 'checkInterpret' },
    // 其他测试步骤...
  ]
}
```

### 支持的测试步骤类型

- `speak` - 模拟用户语音输入，需提供 `text` 参数
- `checkInterpret` - 验证语义理解API调用
- `confirm` - 模拟用户语音确认
- `cancel` - 模拟用户语音取消
- `checkExecute` - 验证执行API调用
- `checkCancel` - 验证取消操作处理
- `checkInterpretError` - 验证语义解析错误处理

## 清理测试文件

测试完成后，可以选择删除 `/frontend/src/mocks` 目录下的测试文件，恢复到无测试状态。

## 注意事项

1. 测试框架通过monkey patching的方式模拟浏览器API，不会实际使用麦克风或扬声器
2. 测试结果会保存在浏览器的localStorage中，可以通过导出按钮获取
3. 测试环境的创建和清理是自动管理的，不会影响实际应用的功能 