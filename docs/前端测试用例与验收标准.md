# 前端测试用例与验收标准

## 1. 测试策略概述

### 1.1 测试金字塔

```
        E2E Tests (10%)
      ┌─────────────────┐
     │  用户流程测试     │
    └─────────────────┘
   Integration Tests (20%)
  ┌─────────────────────┐
 │   组件集成测试        │
└─────────────────────┘
Unit Tests (70%)
┌───────────────────────┐
│    单元测试            │
└───────────────────────┘
```

### 1.2 测试工具栈

- **单元测试**: Jest + React Testing Library
- **集成测试**: Jest + MSW (Mock Service Worker)
- **E2E测试**: Cypress
- **无障碍测试**: jest-axe
- **性能测试**: Lighthouse CI
- **视觉回归**: Chromatic/Percy

### 1.3 测试环境配置

```json
{
  "testEnvironment": "jsdom",
  "setupFilesAfterEnv": ["<rootDir>/src/test-utils/setupTests.js"],
  "moduleNameMapping": {
    "^@/(.*)$": "<rootDir>/src/$1"
  },
  "collectCoverageFrom": [
    "src/**/*.{js,jsx}",
    "!src/index.js",
    "!src/mocks/**"
  ],
  "coverageThreshold": {
    "global": {
      "branches": 80,
      "functions": 80,
      "lines": 80,
      "statements": 80
    }
  }
}
```

## 2. 单元测试用例

### 2.1 登录组件 (LoginForm)

#### 测试文件: `src/components/LoginForm.test.jsx`

```javascript
/**
 * 登录组件单元测试
 * 测试表单渲染、验证、提交等核心功能
 */
describe('LoginForm Component', () => {
  // 基础渲染测试
  test('应该正确渲染登录表单', () => {
    render(<LoginForm />);
    expect(screen.getByLabelText(/用户名/i)).toBeInTheDocument();
    expect(screen.getByLabelText(/密码/i)).toBeInTheDocument();
    expect(screen.getByRole('button', { name: /登录/i })).toBeInTheDocument();
  });

  // 表单验证测试
  test('空用户名时应显示错误提示', async () => {
    render(<LoginForm />);
    const submitButton = screen.getByRole('button', { name: /登录/i });
    
    fireEvent.click(submitButton);
    
    await waitFor(() => {
      expect(screen.getByText(/请输入用户名/i)).toBeInTheDocument();
    });
  });

  test('密码长度不足时应显示错误提示', async () => {
    render(<LoginForm />);
    const passwordInput = screen.getByLabelText(/密码/i);
    const submitButton = screen.getByRole('button', { name: /登录/i });
    
    fireEvent.change(passwordInput, { target: { value: '123' } });
    fireEvent.click(submitButton);
    
    await waitFor(() => {
      expect(screen.getByText(/密码至少6位/i)).toBeInTheDocument();
    });
  });

  // 成功登录测试
  test('有效凭据应触发登录成功', async () => {
    const mockOnLogin = jest.fn();
    render(<LoginForm onLogin={mockOnLogin} />);
    
    fireEvent.change(screen.getByLabelText(/用户名/i), {
      target: { value: 'admin' }
    });
    fireEvent.change(screen.getByLabelText(/密码/i), {
      target: { value: 'admin123' }
    });
    fireEvent.click(screen.getByRole('button', { name: /登录/i }));
    
    await waitFor(() => {
      expect(mockOnLogin).toHaveBeenCalledWith({
        username: 'admin',
        password: 'admin123'
      });
    });
  });

  // 加载状态测试
  test('提交时应显示加载状态', async () => {
    render(<LoginForm />);
    
    fireEvent.change(screen.getByLabelText(/用户名/i), {
      target: { value: 'admin' }
    });
    fireEvent.change(screen.getByLabelText(/密码/i), {
      target: { value: 'admin123' }
    });
    fireEvent.click(screen.getByRole('button', { name: /登录/i }));
    
    expect(screen.getByRole('button', { name: /登录中/i })).toBeDisabled();
  });

  // 无障碍测试
  test('应通过无障碍检查', async () => {
    const { container } = render(<LoginForm />);
    const results = await axe(container);
    expect(results).toHaveNoViolations();
  });
});
```

#### 验收标准:
- ✅ 表单字段正确渲染
- ✅ 必填字段验证生效
- ✅ 密码强度验证
- ✅ 登录成功回调触发
- ✅ 加载状态正确显示
- ✅ 错误信息友好展示
- ✅ 通过无障碍检查
- ✅ 键盘导航支持

### 2.2 注册组件 (RegisterForm)

#### 测试文件: `src/components/RegisterForm.test.jsx`

```javascript
/**
 * 注册组件单元测试
 * 测试表单验证、邮箱格式、密码确认等功能
 */
describe('RegisterForm Component', () => {
  test('应该正确渲染注册表单', () => {
    render(<RegisterForm />);
    expect(screen.getByLabelText(/用户名/i)).toBeInTheDocument();
    expect(screen.getByLabelText(/邮箱/i)).toBeInTheDocument();
    expect(screen.getByLabelText(/^密码$/i)).toBeInTheDocument();
    expect(screen.getByLabelText(/确认密码/i)).toBeInTheDocument();
  });

  test('邮箱格式错误时应显示提示', async () => {
    render(<RegisterForm />);
    const emailInput = screen.getByLabelText(/邮箱/i);
    
    fireEvent.change(emailInput, { target: { value: 'invalid-email' } });
    fireEvent.blur(emailInput);
    
    await waitFor(() => {
      expect(screen.getByText(/请输入有效邮箱/i)).toBeInTheDocument();
    });
  });

  test('密码不一致时应显示错误', async () => {
    render(<RegisterForm />);
    
    fireEvent.change(screen.getByLabelText(/^密码$/i), {
      target: { value: 'password123' }
    });
    fireEvent.change(screen.getByLabelText(/确认密码/i), {
      target: { value: 'different123' }
    });
    
    await waitFor(() => {
      expect(screen.getByText(/密码不一致/i)).toBeInTheDocument();
    });
  });

  test('用户名重复时应显示错误', async () => {
    // Mock API 返回用户名已存在
    server.use(
      rest.post('/api/v1/auth/register', (req, res, ctx) => {
        return res(
          ctx.status(400),
          ctx.json({ detail: '用户名已存在' })
        );
      })
    );

    render(<RegisterForm />);
    
    // 填写表单
    fireEvent.change(screen.getByLabelText(/用户名/i), {
      target: { value: 'existinguser' }
    });
    fireEvent.change(screen.getByLabelText(/邮箱/i), {
      target: { value: 'test@example.com' }
    });
    fireEvent.change(screen.getByLabelText(/^密码$/i), {
      target: { value: 'password123' }
    });
    fireEvent.change(screen.getByLabelText(/确认密码/i), {
      target: { value: 'password123' }
    });
    
    fireEvent.click(screen.getByRole('button', { name: /注册/i }));
    
    await waitFor(() => {
      expect(screen.getByText(/用户名已存在/i)).toBeInTheDocument();
    });
  });
});
```

#### 验收标准:
- ✅ 所有表单字段正确渲染
- ✅ 邮箱格式验证
- ✅ 密码强度验证
- ✅ 密码确认验证
- ✅ 用户名唯一性检查
- ✅ 注册成功处理
- ✅ 错误状态处理
- ✅ 表单重置功能

### 2.3 语音录制控件 (VoiceRecorder)

#### 测试文件: `src/components/VoiceRecorder.test.jsx`

```javascript
/**
 * 语音录制控件单元测试
 * 测试录音开始/停止、权限处理、超时机制
 */
describe('VoiceRecorder Component', () => {
  beforeEach(() => {
    // Mock MediaRecorder API
    global.MediaRecorder = jest.fn().mockImplementation(() => ({
      start: jest.fn(),
      stop: jest.fn(),
      addEventListener: jest.fn(),
      removeEventListener: jest.fn(),
      state: 'inactive'
    }));
    
    // Mock getUserMedia
    global.navigator.mediaDevices = {
      getUserMedia: jest.fn().mockResolvedValue(new MediaStream())
    };
  });

  test('初始状态应显示录音按钮', () => {
    render(<VoiceRecorder />);
    expect(screen.getByRole('button', { name: /开始录音/i })).toBeInTheDocument();
  });

  test('点击录音按钮应开始录音', async () => {
    render(<VoiceRecorder />);
    const recordButton = screen.getByRole('button', { name: /开始录音/i });
    
    fireEvent.click(recordButton);
    
    await waitFor(() => {
      expect(screen.getByRole('button', { name: /停止录音/i })).toBeInTheDocument();
    });
  });

  test('录音超时应自动停止', async () => {
    jest.useFakeTimers();
    const mockOnRecordingComplete = jest.fn();
    
    render(<VoiceRecorder onRecordingComplete={mockOnRecordingComplete} maxDuration={5000} />);
    
    fireEvent.click(screen.getByRole('button', { name: /开始录音/i }));
    
    // 快进到超时
    act(() => {
      jest.advanceTimersByTime(5000);
    });
    
    await waitFor(() => {
      expect(screen.getByText(/录音超时/i)).toBeInTheDocument();
    });
    
    jest.useRealTimers();
  });

  test('麦克风权限被拒绝时应显示错误', async () => {
    global.navigator.mediaDevices.getUserMedia.mockRejectedValue(
      new Error('Permission denied')
    );
    
    render(<VoiceRecorder />);
    fireEvent.click(screen.getByRole('button', { name: /开始录音/i }));
    
    await waitFor(() => {
      expect(screen.getByText(/麦克风权限被拒绝/i)).toBeInTheDocument();
    });
  });

  test('录音完成应触发回调', async () => {
    const mockOnRecordingComplete = jest.fn();
    render(<VoiceRecorder onRecordingComplete={mockOnRecordingComplete} />);
    
    fireEvent.click(screen.getByRole('button', { name: /开始录音/i }));
    
    await waitFor(() => {
      expect(screen.getByRole('button', { name: /停止录音/i })).toBeInTheDocument();
    });
    
    fireEvent.click(screen.getByRole('button', { name: /停止录音/i }));
    
    await waitFor(() => {
      expect(mockOnRecordingComplete).toHaveBeenCalled();
    });
  });
});
```

#### 验收标准:
- ✅ 录音按钮状态切换
- ✅ 麦克风权限处理
- ✅ 录音超时机制
- ✅ 音频数据捕获
- ✅ 错误状态处理
- ✅ 录音完成回调
- ✅ 可视化录音状态
- ✅ 音量指示器

### 2.4 进度条组件 (ProgressBar)

#### 测试文件: `src/components/ProgressBar.test.jsx`

```javascript
/**
 * 进度条组件单元测试
 * 测试四阶段进度显示和状态切换
 */
describe('ProgressBar Component', () => {
  const stages = ['识别中', '理解中', '执行中', '完成'];
  
  test('应该渲染所有阶段', () => {
    render(<ProgressBar currentStage={0} stages={stages} />);
    
    stages.forEach(stage => {
      expect(screen.getByText(stage)).toBeInTheDocument();
    });
  });

  test('当前阶段应该高亮显示', () => {
    render(<ProgressBar currentStage={1} stages={stages} />);
    
    const currentStage = screen.getByText('理解中');
    expect(currentStage).toHaveClass('active');
  });

  test('已完成阶段应该标记为完成', () => {
    render(<ProgressBar currentStage={2} stages={stages} />);
    
    const completedStage = screen.getByText('识别中');
    expect(completedStage).toHaveClass('completed');
  });

  test('进度条填充应该正确计算', () => {
    render(<ProgressBar currentStage={1} stages={stages} />);
    
    const progressFill = screen.getByTestId('progress-fill');
    expect(progressFill).toHaveStyle('width: 50%');
  });

  test('错误状态应该正确显示', () => {
    render(<ProgressBar currentStage={1} stages={stages} error="识别失败" />);
    
    expect(screen.getByText(/识别失败/i)).toBeInTheDocument();
    expect(screen.getByTestId('progress-bar')).toHaveClass('error');
  });
});
```

#### 验收标准:
- ✅ 四阶段正确渲染
- ✅ 当前阶段高亮
- ✅ 进度填充计算
- ✅ 完成状态标记
- ✅ 错误状态处理
- ✅ 动画过渡效果
- ✅ 响应式布局

### 2.5 服务目录组件 (ServiceDirectory)

#### 测试文件: `src/components/ServiceDirectory.test.jsx`

```javascript
/**
 * 服务目录组件单元测试
 * 测试服务列表渲染、搜索过滤、卡片交互
 */
describe('ServiceDirectory Component', () => {
  const mockServices = [
    {
      tool_id: 'translate',
      name: '文本翻译',
      description: '中英互译',
      icon: '/icons/translate.svg',
      category: 'text'
    },
    {
      tool_id: 'weather',
      name: '天气查询',
      description: '获取天气信息',
      icon: '/icons/weather.svg',
      category: 'info'
    }
  ];

  beforeEach(() => {
    server.use(
      rest.get('/api/v1/tools', (req, res, ctx) => {
        return res(ctx.json(mockServices));
      })
    );
  });

  test('应该正确渲染服务列表', async () => {
    render(<ServiceDirectory />);
    
    await waitFor(() => {
      expect(screen.getByText('文本翻译')).toBeInTheDocument();
      expect(screen.getByText('天气查询')).toBeInTheDocument();
    });
  });

  test('搜索功能应该正确过滤服务', async () => {
    render(<ServiceDirectory />);
    
    await waitFor(() => {
      expect(screen.getByText('文本翻译')).toBeInTheDocument();
    });
    
    const searchInput = screen.getByPlaceholderText(/搜索服务/i);
    fireEvent.change(searchInput, { target: { value: '翻译' } });
    
    expect(screen.getByText('文本翻译')).toBeInTheDocument();
    expect(screen.queryByText('天气查询')).not.toBeInTheDocument();
  });

  test('分类筛选应该正确工作', async () => {
    render(<ServiceDirectory />);
    
    await waitFor(() => {
      expect(screen.getByText('文本翻译')).toBeInTheDocument();
    });
    
    const categoryFilter = screen.getByRole('button', { name: /文本/i });
    fireEvent.click(categoryFilter);
    
    expect(screen.getByText('文本翻译')).toBeInTheDocument();
    expect(screen.queryByText('天气查询')).not.toBeInTheDocument();
  });

  test('服务卡片点击应该触发调用', async () => {
    const mockOnServiceCall = jest.fn();
    render(<ServiceDirectory onServiceCall={mockOnServiceCall} />);
    
    await waitFor(() => {
      expect(screen.getByText('文本翻译')).toBeInTheDocument();
    });
    
    const serviceCard = screen.getByTestId('service-translate');
    fireEvent.click(serviceCard);
    
    expect(mockOnServiceCall).toHaveBeenCalledWith('translate');
  });

  test('加载状态应该正确显示', () => {
    server.use(
      rest.get('/api/v1/tools', (req, res, ctx) => {
        return res(ctx.delay(1000), ctx.json(mockServices));
      })
    );
    
    render(<ServiceDirectory />);
    
    expect(screen.getByTestId('loading-spinner')).toBeInTheDocument();
  });

  test('网格布局应该响应式调整', () => {
    render(<ServiceDirectory />);
    
    const grid = screen.getByTestId('services-grid');
    expect(grid).toHaveClass('grid-cols-1', 'sm:grid-cols-2', 'md:grid-cols-3', 'lg:grid-cols-4');
  });
});
```

#### 验收标准:
- ✅ 服务列表正确渲染
- ✅ 搜索过滤功能
- ✅ 分类筛选功能
- ✅ 服务卡片交互
- ✅ 加载状态显示
- ✅ 错误状态处理
- ✅ 响应式网格布局
- ✅ 无障碍键盘导航

## 3. 集成测试用例

### 3.1 用户认证流程集成测试

#### 测试文件: `src/tests/integration/auth.test.jsx`

```javascript
/**
 * 用户认证流程集成测试
 * 测试登录、注册、权限验证的完整流程
 */
describe('用户认证流程集成测试', () => {
  beforeEach(() => {
    // 清除本地存储
    localStorage.clear();
    
    // 重置MSW handlers
    server.resetHandlers();
  });

  test('完整登录流程', async () => {
    // Mock 成功登录响应
    server.use(
      rest.post('/api/v1/auth/token', (req, res, ctx) => {
        return res(
          ctx.json({
            access_token: 'mock-jwt-token',
            token_type: 'bearer',
            user: {
              id: 1,
              username: 'admin',
              role: 'admin'
            }
          })
        );
      })
    );

    render(
      <AuthProvider>
        <Router>
          <App />
        </Router>
      </AuthProvider>
    );

    // 验证初始状态为未登录
    expect(screen.getByText(/登录/i)).toBeInTheDocument();

    // 填写登录表单
    fireEvent.change(screen.getByLabelText(/用户名/i), {
      target: { value: 'admin' }
    });
    fireEvent.change(screen.getByLabelText(/密码/i), {
      target: { value: 'admin123' }
    });
    
    // 提交登录
    fireEvent.click(screen.getByRole('button', { name: /登录/i }));

    // 验证登录成功后的状态
    await waitFor(() => {
      expect(screen.getByText(/欢迎, admin/i)).toBeInTheDocument();
    });

    // 验证token存储
    expect(localStorage.getItem('auth_token')).toBe('mock-jwt-token');

    // 验证路由跳转
    expect(window.location.pathname).toBe('/dashboard');
  });

  test('登录失败处理', async () => {
    server.use(
      rest.post('/api/v1/auth/token', (req, res, ctx) => {
        return res(
          ctx.status(401),
          ctx.json({ detail: '用户名或密码错误' })
        );
      })
    );

    render(
      <AuthProvider>
        <LoginForm />
      </AuthProvider>
    );

    fireEvent.change(screen.getByLabelText(/用户名/i), {
      target: { value: 'wrong' }
    });
    fireEvent.change(screen.getByLabelText(/密码/i), {
      target: { value: 'wrong' }
    });
    
    fireEvent.click(screen.getByRole('button', { name: /登录/i }));

    await waitFor(() => {
      expect(screen.getByText(/用户名或密码错误/i)).toBeInTheDocument();
    });

    // 验证未存储token
    expect(localStorage.getItem('auth_token')).toBeNull();
  });

  test('权限验证和路由保护', async () => {
    // Mock 普通用户登录
    server.use(
      rest.post('/api/v1/auth/token', (req, res, ctx) => {
        return res(
          ctx.json({
            access_token: 'user-token',
            token_type: 'bearer',
            user: {
              id: 2,
              username: 'user',
              role: 'user'
            }
          })
        );
      })
    );

    render(
      <AuthProvider>
        <Router>
          <Routes>
            <Route path="/" element={<LoginForm />} />
            <Route path="/dashboard" element={<Dashboard />} />
            <Route path="/developer" element={
              <ProtectedRoute requiredRole="developer">
                <DeveloperConsole />
              </ProtectedRoute>
            } />
          </Routes>
        </Router>
      </AuthProvider>
    );

    // 登录普通用户
    fireEvent.change(screen.getByLabelText(/用户名/i), {
      target: { value: 'user' }
    });
    fireEvent.change(screen.getByLabelText(/密码/i), {
      target: { value: 'user123' }
    });
    fireEvent.click(screen.getByRole('button', { name: /登录/i }));

    await waitFor(() => {
      expect(screen.getByText(/仪表板/i)).toBeInTheDocument();
    });

    // 尝试访问开发者页面
    fireEvent.click(screen.getByText(/开发者控制台/i));

    // 应该显示权限不足提示
    await waitFor(() => {
      expect(screen.getByText(/权限不足/i)).toBeInTheDocument();
    });
  });
});
```

### 3.2 语音交互流程集成测试

#### 测试文件: `src/tests/integration/voice-interaction.test.jsx`

```javascript
/**
 * 语音交互流程集成测试
 * 测试录音、识别、执行的完整流程
 */
describe('语音交互流程集成测试', () => {
  beforeEach(() => {
    // Mock 语音API
    global.MediaRecorder = jest.fn().mockImplementation(() => ({
      start: jest.fn(),
      stop: jest.fn(),
      addEventListener: jest.fn((event, callback) => {
        if (event === 'dataavailable') {
          setTimeout(() => callback({ data: new Blob(['audio'], { type: 'audio/wav' }) }), 100);
        }
      }),
      removeEventListener: jest.fn(),
      state: 'inactive'
    }));
    
    global.navigator.mediaDevices = {
      getUserMedia: jest.fn().mockResolvedValue(new MediaStream())
    };
  });

  test('完整语音交互流程', async () => {
    // Mock API 响应
    server.use(
      rest.post('/api/v1/intent/interpret', (req, res, ctx) => {
        return res(
          ctx.json({
            text: '查询今天天气',
            intent: 'weather_query',
            entities: { location: '北京' },
            confidence: 0.95
          })
        );
      }),
      rest.post('/api/v1/tools/weather/execute', (req, res, ctx) => {
        return res(
          ctx.json({
            result: '北京今天晴，温度25°C',
            success: true
          })
        );
      })
    );

    render(
      <InteractionProvider>
        <VoiceInteractionPage />
      </InteractionProvider>
    );

    // 开始录音
    const recordButton = screen.getByRole('button', { name: /开始录音/i });
    fireEvent.click(recordButton);

    // 验证录音状态
    await waitFor(() => {
      expect(screen.getByText(/正在录音/i)).toBeInTheDocument();
      expect(screen.getByTestId('progress-bar')).toHaveTextContent('识别中');
    });

    // 停止录音
    const stopButton = screen.getByRole('button', { name: /停止录音/i });
    fireEvent.click(stopButton);

    // 验证识别阶段
    await waitFor(() => {
      expect(screen.getByTestId('progress-bar')).toHaveTextContent('理解中');
    });

    // 验证执行阶段
    await waitFor(() => {
      expect(screen.getByTestId('progress-bar')).toHaveTextContent('执行中');
    });

    // 验证完成状态
    await waitFor(() => {
      expect(screen.getByText(/北京今天晴，温度25°C/i)).toBeInTheDocument();
      expect(screen.getByTestId('progress-bar')).toHaveTextContent('完成');
    });
  });

  test('语音识别失败处理', async () => {
    server.use(
      rest.post('/api/v1/intent/interpret', (req, res, ctx) => {
        return res(
          ctx.status(400),
          ctx.json({ detail: '音频质量过低，无法识别' })
        );
      })
    );

    render(
      <InteractionProvider>
        <VoiceInteractionPage />
      </InteractionProvider>
    );

    // 录音流程
    fireEvent.click(screen.getByRole('button', { name: /开始录音/i }));
    
    await waitFor(() => {
      expect(screen.getByRole('button', { name: /停止录音/i })).toBeInTheDocument();
    });
    
    fireEvent.click(screen.getByRole('button', { name: /停止录音/i }));

    // 验证错误处理
    await waitFor(() => {
      expect(screen.getByText(/音频质量过低，无法识别/i)).toBeInTheDocument();
      expect(screen.getByRole('button', { name: /重试/i })).toBeInTheDocument();
    });
  });
});
```

## 4. E2E测试用例

### 4.1 用户完整使用流程

#### 测试文件: `cypress/e2e/user-journey.cy.js`

```javascript
/**
 * 用户完整使用流程E2E测试
 * 从登录到使用服务的完整用户旅程
 */
describe('用户完整使用流程', () => {
  beforeEach(() => {
    // 访问应用首页
    cy.visit('/');
    
    // 清除本地存储
    cy.clearLocalStorage();
  });

  it('新用户注册并使用语音服务', () => {
    // 1. 访问注册页面
    cy.contains('注册').click();
    cy.url().should('include', '/register');

    // 2. 填写注册信息
    cy.get('[data-testid="username-input"]').type('newuser');
    cy.get('[data-testid="email-input"]').type('newuser@example.com');
    cy.get('[data-testid="password-input"]').type('password123');
    cy.get('[data-testid="confirm-password-input"]').type('password123');

    // 3. 提交注册
    cy.get('[data-testid="register-button"]').click();

    // 4. 验证注册成功
    cy.contains('注册成功').should('be.visible');
    cy.url().should('include', '/login');

    // 5. 登录
    cy.get('[data-testid="username-input"]').type('newuser');
    cy.get('[data-testid="password-input"]').type('password123');
    cy.get('[data-testid="login-button"]').click();

    // 6. 验证登录成功，进入仪表板
    cy.url().should('include', '/dashboard');
    cy.contains('欢迎, newuser').should('be.visible');

    // 7. 访问语音交互页面
    cy.get('[data-testid="voice-interaction-nav"]').click();
    cy.url().should('include', '/voice');

    // 8. 开始语音录制（模拟）
    cy.get('[data-testid="record-button"]').click();
    cy.contains('正在录音').should('be.visible');

    // 9. 停止录制
    cy.wait(2000); // 模拟录音时间
    cy.get('[data-testid="stop-button"]').click();

    // 10. 验证处理流程
    cy.contains('识别中').should('be.visible');
    cy.contains('理解中').should('be.visible');
    cy.contains('执行中').should('be.visible');
    
    // 11. 验证结果显示
    cy.contains('完成').should('be.visible');
    cy.get('[data-testid="result-display"]').should('be.visible');
  });

  it('开发者用户管理自定义工具', () => {
    // 1. 以开发者身份登录
    cy.login('developer', 'dev123');

    // 2. 访问开发者控制台
    cy.get('[data-testid="developer-console-nav"]').click();
    cy.url().should('include', '/developer');

    // 3. 查看现有工具列表
    cy.get('[data-testid="tools-list"]').should('be.visible');

    // 4. 添加新工具
    cy.get('[data-testid="add-tool-button"]').click();
    cy.get('[data-testid="tool-name-input"]').type('自定义翻译工具');
    cy.get('[data-testid="tool-description-input"]').type('基于GPT的高质量翻译');
    cy.get('[data-testid="tool-endpoint-input"]').type('https://api.example.com/translate');
    
    // 5. 上传工具配置
    cy.get('[data-testid="config-file-input"]').selectFile('cypress/fixtures/tool-config.json');
    
    // 6. 提交工具
    cy.get('[data-testid="submit-tool-button"]').click();
    
    // 7. 验证工具添加成功
    cy.contains('工具添加成功').should('be.visible');
    cy.contains('自定义翻译工具').should('be.visible');

    // 8. 测试工具启用/禁用
    cy.get('[data-testid="tool-toggle-自定义翻译工具"]').click();
    cy.contains('工具已禁用').should('be.visible');
    
    cy.get('[data-testid="tool-toggle-自定义翻译工具"]').click();
    cy.contains('工具已启用').should('be.visible');

    // 9. 验证工具在服务目录中显示
    cy.get('[data-testid="services-nav"]').click();
    cy.contains('自定义翻译工具').should('be.visible');
  });

  it('管理员用户系统管理', () => {
    // 1. 以管理员身份登录
    cy.login('admin', 'admin123');

    // 2. 访问管理员面板
    cy.get('[data-testid="admin-panel-nav"]').click();
    cy.url().should('include', '/admin');

    // 3. 查看用户管理
    cy.get('[data-testid="user-management-tab"]').click();
    cy.get('[data-testid="users-table"]').should('be.visible');

    // 4. 查看系统统计
    cy.get('[data-testid="system-stats-tab"]').click();
    cy.get('[data-testid="stats-dashboard"]').should('be.visible');
    
    // 验证统计数据
    cy.get('[data-testid="total-users"]').should('contain.text', '用户总数');
    cy.get('[data-testid="total-tools"]').should('contain.text', '工具总数');
    cy.get('[data-testid="daily-requests"]').should('contain.text', '今日请求');

    // 5. 查看MCP服务状态
    cy.get('[data-testid="mcp-status-tab"]').click();
    cy.get('[data-testid="mcp-services-list"]').should('be.visible');
    
    // 验证服务状态
    cy.get('[data-testid="service-status"]').each(($el) => {
      cy.wrap($el).should('contain.text', '运行中').or('contain.text', '已停止');
    });
  });
});
```

### 4.2 响应式设计测试

#### 测试文件: `cypress/e2e/responsive.cy.js`

```javascript
/**
 * 响应式设计E2E测试
 * 测试不同设备尺寸下的布局和交互
 */
describe('响应式设计测试', () => {
  const viewports = [
    { device: 'iPhone 6', width: 375, height: 667 },
    { device: 'iPad', width: 768, height: 1024 },
    { device: 'Desktop', width: 1280, height: 800 }
  ];

  viewports.forEach(({ device, width, height }) => {
    context(`${device} (${width}x${height})`, () => {
      beforeEach(() => {
        cy.viewport(width, height);
        cy.visit('/');
        cy.login('user', 'user123');
      });

      it('导航菜单应该正确显示', () => {
        if (width < 768) {
          // 移动端：汉堡菜单
          cy.get('[data-testid="mobile-menu-button"]').should('be.visible');
          cy.get('[data-testid="desktop-nav"]').should('not.be.visible');
          
          // 点击汉堡菜单
          cy.get('[data-testid="mobile-menu-button"]').click();
          cy.get('[data-testid="mobile-nav"]').should('be.visible');
        } else {
          // 桌面端：水平导航
          cy.get('[data-testid="desktop-nav"]').should('be.visible');
          cy.get('[data-testid="mobile-menu-button"]').should('not.be.visible');
        }
      });

      it('服务目录网格应该响应式调整', () => {
        cy.visit('/services');
        
        if (width < 640) {
          // 小屏：1列
          cy.get('[data-testid="services-grid"]')
            .should('have.class', 'grid-cols-1');
        } else if (width < 768) {
          // 中屏：2列
          cy.get('[data-testid="services-grid"]')
            .should('have.class', 'sm:grid-cols-2');
        } else if (width < 1024) {
          // 大屏：3列
          cy.get('[data-testid="services-grid"]')
            .should('have.class', 'md:grid-cols-3');
        } else {
          // 超大屏：4列
          cy.get('[data-testid="services-grid"]')
            .should('have.class', 'lg:grid-cols-4');
        }
      });

      it('表单应该在所有设备上可用', () => {
        cy.visit('/developer');
        
        // 表单应该正确显示
        cy.get('[data-testid="add-tool-form"]').should('be.visible');
        
        // 输入字段应该可访问
        cy.get('[data-testid="tool-name-input"]').should('be.visible').type('测试工具');
        cy.get('[data-testid="tool-description-input"]').should('be.visible').type('测试描述');
        
        // 按钮应该可点击
        cy.get('[data-testid="submit-tool-button"]').should('be.visible').and('not.be.disabled');
      });

      it('语音录制界面应该适配设备', () => {
        cy.visit('/voice');
        
        // 录音按钮应该足够大，便于触摸
        cy.get('[data-testid="record-button"]')
          .should('be.visible')
          .and('have.css', 'min-height')
          .and('match', /^(44|48|56)px$/);
        
        // 进度条应该可见
        cy.get('[data-testid="progress-bar"]').should('be.visible');
        
        // 结果显示区域应该适当大小
        cy.get('[data-testid="result-display"]').should('be.visible');
      });
    });
  });
});
```

## 5. 性能测试用例

### 5.1 Lighthouse性能测试

#### 测试文件: `cypress/e2e/performance.cy.js`

```javascript
/**
 * 性能测试用例
 * 使用Lighthouse测试页面性能指标
 */
describe('性能测试', () => {
  it('首页性能指标应该达标', () => {
    cy.visit('/');
    
    cy.lighthouse({
      performance: 85,
      accessibility: 90,
      'best-practices': 85,
      seo: 80
    });
  });

  it('服务目录页面性能应该达标', () => {
    cy.login('user', 'user123');
    cy.visit('/services');
    
    cy.lighthouse({
      performance: 80,
      accessibility: 90,
      'best-practices': 85
    });
  });

  it('开发者控制台性能应该达标', () => {
    cy.login('developer', 'dev123');
    cy.visit('/developer');
    
    cy.lighthouse({
      performance: 75,
      accessibility: 90,
      'best-practices': 85
    });
  });
});
```

### 5.2 加载性能测试

#### 测试文件: `src/tests/performance/loading.test.js`

```javascript
/**
 * 加载性能测试
 * 测试组件渲染时间和资源加载
 */
describe('加载性能测试', () => {
  test('服务目录组件渲染时间应该小于100ms', async () => {
    const startTime = performance.now();
    
    render(<ServiceDirectory />);
    
    await waitFor(() => {
      expect(screen.getByTestId('services-grid')).toBeInTheDocument();
    });
    
    const endTime = performance.now();
    const renderTime = endTime - startTime;
    
    expect(renderTime).toBeLessThan(100);
  });

  test('大量服务列表渲染性能', async () => {
    const largeServiceList = Array.from({ length: 100 }, (_, i) => ({
      tool_id: `service-${i}`,
      name: `服务 ${i}`,
      description: `描述 ${i}`,
      icon: `/icons/service-${i}.svg`
    }));

    server.use(
      rest.get('/api/v1/tools', (req, res, ctx) => {
        return res(ctx.json(largeServiceList));
      })
    );

    const startTime = performance.now();
    
    render(<ServiceDirectory />);
    
    await waitFor(() => {
      expect(screen.getAllByTestId(/^service-/)).toHaveLength(100);
    });
    
    const endTime = performance.now();
    const renderTime = endTime - startTime;
    
    // 100个服务卡片渲染时间应该小于500ms
    expect(renderTime).toBeLessThan(500);
  });

  test('语音录制组件内存使用', async () => {
    const initialMemory = performance.memory?.usedJSHeapSize || 0;
    
    const { unmount } = render(<VoiceRecorder />);
    
    // 模拟录音操作
    fireEvent.click(screen.getByRole('button', { name: /开始录音/i }));
    await waitFor(() => {
      expect(screen.getByRole('button', { name: /停止录音/i })).toBeInTheDocument();
    });
    
    fireEvent.click(screen.getByRole('button', { name: /停止录音/i }));
    
    unmount();
    
    // 强制垃圾回收（如果支持）
    if (global.gc) {
      global.gc();
    }
    
    const finalMemory = performance.memory?.usedJSHeapSize || 0;
    const memoryIncrease = finalMemory - initialMemory;
    
    // 内存增长应该小于10MB
    expect(memoryIncrease).toBeLessThan(10 * 1024 * 1024);
  });
});
```

## 6. 无障碍测试用例

### 6.1 键盘导航测试

#### 测试文件: `src/tests/accessibility/keyboard-navigation.test.jsx`

```javascript
/**
 * 键盘导航无障碍测试
 * 确保所有交互元素都可以通过键盘访问
 */
describe('键盘导航测试', () => {
  test('登录表单键盘导航', () => {
    render(<LoginForm />);
    
    const usernameInput = screen.getByLabelText(/用户名/i);
    const passwordInput = screen.getByLabelText(/密码/i);
    const submitButton = screen.getByRole('button', { name: /登录/i });
    
    // Tab导航顺序
    usernameInput.focus();
    expect(usernameInput).toHaveFocus();
    
    userEvent.tab();
    expect(passwordInput).toHaveFocus();
    
    userEvent.tab();
    expect(submitButton).toHaveFocus();
    
    // Enter键提交
    fireEvent.keyDown(submitButton, { key: 'Enter', code: 'Enter' });
    // 验证表单提交逻辑
  });

  test('服务目录键盘导航', async () => {
    const mockServices = [
      { tool_id: 'service1', name: '服务1' },
      { tool_id: 'service2', name: '服务2' }
    ];
    
    server.use(
      rest.get('/api/v1/tools', (req, res, ctx) => {
        return res(ctx.json(mockServices));
      })
    );
    
    render(<ServiceDirectory />);
    
    await waitFor(() => {
      expect(screen.getByText('服务1')).toBeInTheDocument();
    });
    
    const service1Card = screen.getByTestId('service-service1');
    const service2Card = screen.getByTestId('service-service2');
    
    // 确保服务卡片可以获得焦点
    expect(service1Card).toHaveAttribute('tabindex', '0');
    expect(service2Card).toHaveAttribute('tabindex', '0');
    
    // 测试方向键导航
    service1Card.focus();
    expect(service1Card).toHaveFocus();
    
    fireEvent.keyDown(service1Card, { key: 'ArrowRight' });
    expect(service2Card).toHaveFocus();
    
    fireEvent.keyDown(service2Card, { key: 'ArrowLeft' });
    expect(service1Card).toHaveFocus();
    
    // 测试Enter键激活
    const mockOnServiceCall = jest.fn();
    render(<ServiceDirectory onServiceCall={mockOnServiceCall} />);
    
    await waitFor(() => {
      expect(screen.getByText('服务1')).toBeInTheDocument();
    });
    
    const serviceCard = screen.getByTestId('service-service1');
    serviceCard.focus();
    fireEvent.keyDown(serviceCard, { key: 'Enter' });
    
    expect(mockOnServiceCall).toHaveBeenCalledWith('service1');
  });

  test('语音录制键盘控制', () => {
    render(<VoiceRecorder />);
    
    const recordButton = screen.getByRole('button', { name: /开始录音/i });
    
    // 空格键开始录音
    recordButton.focus();
    fireEvent.keyDown(recordButton, { key: ' ', code: 'Space' });
    
    expect(screen.getByRole('button', { name: /停止录音/i })).toBeInTheDocument();
    
    // Escape键停止录音
    fireEvent.keyDown(document, { key: 'Escape', code: 'Escape' });
    
    expect(screen.getByRole('button', { name: /开始录音/i })).toBeInTheDocument();
  });
});
```

### 6.2 屏幕阅读器测试

#### 测试文件: `src/tests/accessibility/screen-reader.test.jsx`

```javascript
/**
 * 屏幕阅读器无障碍测试
 * 确保内容对屏幕阅读器友好
 */
describe('屏幕阅读器测试', () => {
  test('表单标签和描述', () => {
    render(<LoginForm />);
    
    const usernameInput = screen.getByLabelText(/用户名/i);
    const passwordInput = screen.getByLabelText(/密码/i);
    
    // 验证aria-label或关联的label
    expect(usernameInput).toHaveAccessibleName('用户名');
    expect(passwordInput).toHaveAccessibleName('密码');
    
    // 验证错误信息关联
    fireEvent.click(screen.getByRole('button', { name: /登录/i }));
    
    const errorMessage = screen.getByText(/请输入用户名/i);
    expect(usernameInput).toHaveAccessibleDescription('请输入用户名');
  });

  test('进度条状态公告', () => {
    render(<ProgressBar currentStage={1} stages={['识别中', '理解中', '执行中', '完成']} />);
    
    const progressBar = screen.getByRole('progressbar');
    
    expect(progressBar).toHaveAttribute('aria-valuenow', '50');
    expect(progressBar).toHaveAttribute('aria-valuemin', '0');
    expect(progressBar).toHaveAttribute('aria-valuemax', '100');
    expect(progressBar).toHaveAttribute('aria-valuetext', '理解中 - 50%完成');
  });

  test('动态内容更新公告', async () => {
    render(<VoiceInteractionPage />);
    
    // 验证live region存在
    const liveRegion = screen.getByRole('status');
    expect(liveRegion).toHaveAttribute('aria-live', 'polite');
    
    // 模拟状态更新
    fireEvent.click(screen.getByRole('button', { name: /开始录音/i }));
    
    await waitFor(() => {
      expect(liveRegion).toHaveTextContent('开始录音');
    });
    
    fireEvent.click(screen.getByRole('button', { name: /停止录音/i }));
    
    await waitFor(() => {
      expect(liveRegion).toHaveTextContent('正在处理语音');
    });
  });

  test('服务卡片可访问性', async () => {
    const mockServices = [
      {
        tool_id: 'translate',
        name: '文本翻译',
        description: '中英互译服务',
        category: 'text'
      }
    ];
    
    server.use(
      rest.get('/api/v1/tools', (req, res, ctx) => {
        return res(ctx.json(mockServices));
      })
    );
    
    render(<ServiceDirectory />);
    
    await waitFor(() => {
      expect(screen.getByText('文本翻译')).toBeInTheDocument();
    });
    
    const serviceCard = screen.getByRole('button', { name: /文本翻译.*中英互译服务/i });
    
    expect(serviceCard).toHaveAttribute('aria-describedby');
    expect(serviceCard).toHaveAccessibleName('文本翻译 - 中英互译服务');
  });
});
```

## 7. 测试数据和Mock配置

### 7.1 测试数据工厂

#### 文件: `src/test-utils/factories.js`

```javascript
/**
 * 测试数据工厂
 * 生成一致的测试数据
 */
export const createMockUser = (overrides = {}) => ({
  id: 1,
  username: 'testuser',
  email: 'test@example.com',
  role: 'user',
  created_at: '2024-01-01T00:00:00Z',
  ...overrides
});

export const createMockService = (overrides = {}) => ({
  tool_id: 'test-service',
  name: '测试服务',
  description: '这是一个测试服务',
  icon: '/icons/test.svg',
  category: 'test',
  enabled: true,
  ...overrides
});

export const createMockAuthResponse = (overrides = {}) => ({
  access_token: 'mock-jwt-token',
  token_type: 'bearer',
  user: createMockUser(),
  ...overrides
});

export const createMockVoiceResult = (overrides = {}) => ({
  text: '你好世界',
  intent: 'greeting',
  entities: {},
  confidence: 0.95,
  ...overrides
});

export const createMockServiceList = (count = 5) => {
  return Array.from({ length: count }, (_, i) => 
    createMockService({
      tool_id: `service-${i}`,
      name: `服务 ${i}`,
      description: `这是服务 ${i} 的描述`
    })
  );
};
```

### 7.2 MSW Mock配置

#### 文件: `src/mocks/handlers.js`

```javascript
/**
 * MSW Mock处理器
 * 模拟后端API响应
 */
import { rest } from 'msw';
import {
  createMockAuthResponse,
  createMockUser,
  createMockServiceList,
  createMockVoiceResult
} from '../test-utils/factories';

export const handlers = [
  // 认证相关
  rest.post('/api/v1/auth/token', (req, res, ctx) => {
    const { username, password } = req.body;
    
    // 模拟测试账号
    const testAccounts = {
      'admin': { password: 'admin123', role: 'admin' },
      'developer': { password: 'dev123', role: 'developer' },
      'user': { password: 'user123', role: 'user' }
    };
    
    const account = testAccounts[username];
    
    if (account && account.password === password) {
      return res(
        ctx.json(createMockAuthResponse({
          user: createMockUser({ username, role: account.role })
        }))
      );
    }
    
    return res(
      ctx.status(401),
      ctx.json({ detail: '用户名或密码错误' })
    );
  }),

  rest.post('/api/v1/auth/register', (req, res, ctx) => {
    const { username, email, password } = req.body;
    
    // 模拟用户名重复检查
    if (username === 'existinguser') {
      return res(
        ctx.status(400),
        ctx.json({ detail: '用户名已存在' })
      );
    }
    
    return res(
      ctx.json({
        message: '注册成功',
        user: createMockUser({ username, email })
      })
    );
  }),

  // 工具服务相关
  rest.get('/api/v1/tools', (req, res, ctx) => {
    const services = createMockServiceList(6);
    return res(ctx.json(services));
  }),

  // 语音识别相关
  rest.post('/api/v1/intent/interpret', (req, res, ctx) => {
    return res(
      ctx.json(createMockVoiceResult({
        text: '查询今天天气',
        intent: 'weather_query',
        entities: { location: '北京' }
      }))
    );
  }),

  // 开发者工具管理
  rest.get('/api/v1/dev/tools', (req, res, ctx) => {
    return res(
      ctx.json([
        {
          id: 1,
          name: '自定义翻译工具',
          description: '基于GPT的翻译服务',
          endpoint: 'https://api.example.com/translate',
          enabled: true,
          created_at: '2024-01-01T00:00:00Z'
        }
      ])
    );
  }),

  rest.post('/api/v1/dev/tools', (req, res, ctx) => {
    return res(
      ctx.json({ message: '工具添加成功', id: 2 })
    );
  }),

  rest.patch('/api/v1/dev/tools/:id', (req, res, ctx) => {
    return res(
      ctx.json({ message: '工具状态已更新' })
    );
  }),

  // MCP服务状态
  rest.get('/api/v1/mcp/status', (req, res, ctx) => {
    return res(
      ctx.json({
        services: [
          { name: 'web3-mcp', status: 'running', uptime: '2h 30m' },
          { name: 'translate-mcp', status: 'running', uptime: '1h 15m' }
        ]
      })
    );
  })
];
```

### 7.3 Cypress自定义命令

#### 文件: `cypress/support/commands.js`

```javascript
/**
 * Cypress自定义命令
 * 封装常用的测试操作
 */

// 登录命令
Cypress.Commands.add('login', (username, password) => {
  cy.visit('/login');
  cy.get('[data-testid="username-input"]').type(username);
  cy.get('[data-testid="password-input"]').type(password);
  cy.get('[data-testid="login-button"]').click();
  cy.url().should('include', '/dashboard');
});

// 语音录制模拟
Cypress.Commands.add('simulateVoiceRecording', (duration = 2000) => {
  cy.get('[data-testid="record-button"]').click();
  cy.wait(duration);
  cy.get('[data-testid="stop-button"]').click();
});

// 等待API响应
Cypress.Commands.add('waitForApiResponse', (alias) => {
  cy.wait(alias).then((interception) => {
    expect(interception.response.statusCode).to.be.oneOf([200, 201]);
  });
});

// 检查无障碍性
Cypress.Commands.add('checkA11y', (context, options) => {
  cy.injectAxe();
  cy.checkA11y(context, options);
});

// 模拟网络延迟
Cypress.Commands.add('simulateSlowNetwork', () => {
  cy.intercept('**', (req) => {
    req.reply((res) => {
      res.delay(1000);
    });
  });
});
```

## 8. 测试执行和CI/CD集成

### 8.1 测试脚本配置

#### 文件: `package.json` (测试脚本部分)

```json
{
  "scripts": {
    "test": "jest",
    "test:watch": "jest --watch",
    "test:coverage": "jest --coverage",
    "test:unit": "jest --testPathPattern=src/.*\\.test\\.(js|jsx)$",
    "test:integration": "jest --testPathPattern=src/tests/integration",
    "test:e2e": "cypress run",
    "test:e2e:open": "cypress open",
    "test:a11y": "jest --testPathPattern=accessibility",
    "test:performance": "jest --testPathPattern=performance",
    "test:all": "npm run test:unit && npm run test:integration && npm run test:e2e",
    "test:ci": "npm run test:coverage && npm run test:e2e -- --record"
  }
}
```

### 8.2 GitHub Actions工作流

#### 文件: `.github/workflows/test.yml`

```yaml
name: 前端测试流水线

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  unit-tests:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: 设置Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          cache: 'npm'
      
      - name: 安装依赖
        run: npm ci
      
      - name: 运行单元测试
        run: npm run test:coverage
      
      - name: 上传覆盖率报告
        uses: codecov/codecov-action@v3
        with:
          file: ./coverage/lcov.info

  e2e-tests:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: 设置Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          cache: 'npm'
      
      - name: 安装依赖
        run: npm ci
      
      - name: 构建应用
        run: npm run build
      
      - name: 运行E2E测试
        uses: cypress-io/github-action@v5
        with:
          start: npm start
          wait-on: 'http://localhost:3000'
          record: true
        env:
          CYPRESS_RECORD_KEY: ${{ secrets.CYPRESS_RECORD_KEY }}

  lighthouse:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: 设置Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          cache: 'npm'
      
      - name: 安装依赖
        run: npm ci
      
      - name: 构建应用
        run: npm run build
      
      - name: 运行Lighthouse CI
        run: |
          npm install -g @lhci/cli@0.12.x
          lhci autorun
        env:
          LHCI_GITHUB_APP_TOKEN: ${{ secrets.LHCI_GITHUB_APP_TOKEN }}
```

## 9. 测试报告和质量门禁

### 9.1 覆盖率要求

- **单元测试覆盖率**: ≥ 80%
- **集成测试覆盖率**: ≥ 70%
- **关键路径覆盖率**: ≥ 95%

### 9.2 性能指标要求

- **首屏加载时间**: ≤ 2秒
- **Lighthouse性能分数**: ≥ 85分
- **无障碍分数**: ≥ 90分
- **最佳实践分数**: ≥ 85分

### 9.3 质量门禁标准

#### 代码提交前检查:
- ✅ 所有单元测试通过
- ✅ 代码覆盖率达标
- ✅ ESLint检查通过
- ✅ 类型检查通过

#### Pull Request检查:
- ✅ 所有测试套件通过
- ✅ E2E测试通过
- ✅ 性能测试达标
- ✅ 无障碍测试通过
- ✅ 代码审查通过

#### 发布前检查:
- ✅ 完整测试套件通过
- ✅ 性能基准测试
- ✅ 兼容性测试
- ✅ 安全扫描通过

## 10. 测试最佳实践

### 10.1 测试编写原则

1. **AAA模式**: Arrange(准备) → Act(执行) → Assert(断言)
2. **单一职责**: 每个测试只验证一个功能点
3. **独立性**: 测试之间不应相互依赖
4. **可重复性**: 测试结果应该一致可重复
5. **快速反馈**: 单元测试应该快速执行

### 10.2 Mock策略

1. **外部依赖**: 始终Mock外部API和服务
2. **时间相关**: Mock Date、setTimeout等时间函数
3. **随机性**: Mock Math.random等随机函数
4. **浏览器API**: Mock localStorage、sessionStorage等
5. **第三方库**: 适当Mock复杂的第三方库

### 10.3 测试数据管理

1. **工厂模式**: 使用工厂函数生成测试数据
2. **最小数据集**: 只包含测试必需的数据
3. **数据隔离**: 每个测试使用独立的数据
4. **清理机制**: 测试后清理产生的数据

### 10.4 调试技巧

1. **断点调试**: 在测试中设置断点
2. **日志输出**: 使用console.log查看中间状态
3. **快照测试**: 使用Jest快照功能
4. **测试覆盖率**: 查看未覆盖的代码分支
5. **错误信息**: 编写清晰的断言错误信息

---

## 总结

本文档提供了完整的前端测试用例和验收标准，涵盖了:

- **14个核心功能模块**的详细测试用例
- **单元测试、集成测试、E2E测试**的完整覆盖
- **性能测试和无障碍测试**的专项验证
- **CI/CD集成**和质量门禁标准
- **测试最佳实践**和调试技巧

通过执行这些测试用例，可以确保前端应用的质量、性能和用户体验达到预期标准。